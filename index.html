<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>è‡ªå‹•æ‰“å¡</title>
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body style="font-family:sans-serif;text-align:center;">
  <h2>æ™Ÿæ¥­é‹æ¥­æ‰“å¡ç³»çµ±</h2>
  <p>è«‹é¸æ“‡æ‰“å¡é¡å‹ï¼š</p>

  <button onclick="checkin('ä¸Šç­')" style="margin:5px;">ğŸ•“ ä¸Šç­</button>
  <button onclick="checkin('ä¸‹ç­')" style="margin:5px;">ğŸŒ™ ä¸‹ç­</button>
  <button onclick="checkin('åŠ ç­')" style="margin:5px;">ğŸ’ª åŠ ç­</button>

  <script>
    const centerLat = 22.582212;
    const centerLon = 120.404301;
    const maxDistance = 200; // å…¬å°º

    function haversine(lat1, lon1, lat2, lon2) {
      const R = 6371e3;
      const Ï†1 = lat1 * Math.PI/180;
      const Ï†2 = lat2 * Math.PI/180;
      const Î”Ï† = (lat2 - lat1) * Math.PI/180;
      const Î”Î» = (lon2 - lon1) * Math.PI/180;
      const a = Math.sin(Î”Ï†/2)**2 + Math.cos(Ï†1)*Math.cos(Ï†2)*Math.sin(Î”Î»/2)**2;
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R*c;
    }

    async function checkin(type) {
      await liff.init({ liffId: "2008432102-M9Wgn3WG" });
      if (!liff.isInClient()) {
        alert("è«‹åœ¨ LINE App å…§é–‹å•Ÿæ­¤åŠŸèƒ½");
        return;
      }

      navigator.geolocation.getCurrentPosition(async pos => {
        const { latitude, longitude } = pos.coords;
        const distance = haversine(latitude, longitude, centerLat, centerLon);
        let msg;
        if (distance <= maxDistance) {
          msg = `âœ… ${type}æ‰“å¡æˆåŠŸï¼\nè·é›¢å» å€ï¼š${distance.toFixed(1)} å…¬å°º`;
        } else {
          msg = `âŒ ${type}æ‰“å¡å¤±æ•—ï¼ˆè¶…å‡ºç¯„åœ ${distance.toFixed(1)} å…¬å°ºï¼‰`;
        }

        await liff.sendMessages([{ type: "text", text: msg }]);
        liff.closeWindow();
      }, err => {
        alert("å®šä½å¤±æ•—ï¼š" + err.message);
        liff.closeWindow();
      });
    }
  </script>
</body>
</html>
